dist: xenial
sudo: required
language:
- cpp
cache:
- apt
notifications:
  slack:
    secure: dN+sNePHYq1PMm+E9S6Dk4UobyKS4r+fs0Xr8378UGt189HYV0al4DXPF95mnbQXknd9SbMA/qAWM7HRIt5plS4DjuR/7I5yrZnlnl1P6GPKtyhsCWrwgAyFWK5m+6bewzf/8pUg2YYGODGPBDReFqfli6c4Web1g/XW3M/DaVa4L7TqlKsmDEbYFDmooT8a1WFuxcYMSdgr3LGF2FBoPQVuBxYLYQX2xJ93KeniSzvsY5YMtBvMd5NP2C2/TWmJEMCvkLRbmFsl/eo8Nf4W9rNVt08kErQoRuABYO433ipZ+0zyFgzz2VVm0hxfVsSKUEt+uOarO/xP1z7mAnhrPeNWoM7Kw57djqEoqVRbr9EdKf5fg+UKLFWmlTvGagtzU4PB2/0Zq4sw/cdyXDDdMXwxjokpN9swvCM1faIWcG3A7M9mscIW/32hTmstqLtHG/1w0nNtg/N0Y16NOzCk98G2qiuCK+x031/TQDs0PE4JmilftW2nNhg5834dmMYsqKelLn5tVsXWKWMnQuZx22a7JQNQst9/Pt09+HuEzHfpUIZimjd8UoSIWlLJfocqM63ymUKY/t6TlTlLSkLexAAR/mzhyNQxZoYLHyxyJI8EjXu5KEVWH4Tw34oM2AcGE4bvg43LAajUQ/iz/7sxGcKN048uTzGF4uAz1Vutksk=
addons:
  apt:
    packages:
    - doxygen
matrix:
  include:
  - name: Xenial kinetic
    dist: xenial
    env: ROS_DISTRO=kinetic
env:
  global:
    ROS_DISTRO: kinetic
    ROS_CI_DESKTOP: "`lsb_release -cs`"
    CI_SOURCE_PATH: "$(pwd)"
    ROSINSTALL_FILE: "$CI_SOURCE_PATH/dependencies.rosinstall"
    CATKIN_OPTIONS: "$CI_SOURCE_PATH/catkin.options"
    ROS_PARALLEL_JOBS: "-j8 -l6"
    PYTHONPATH: "$PYTHONPATH:/usr/lib/python2.7/dist-packages:/usr/local/lib/python2.7/dist-packages"
before_install:
- sudo sh -c "echo \"deb http://packages.ros.org/ros/ubuntu $ROS_CI_DESKTOP main\"
  > /etc/apt/sources.list.d/ros-latest.list"
- sudo apt-key adv --keyserver hkp://ha.pool.sks-keyservers.net:80 --recv-key 421C365BD9FF1F717815A3895523BAEEB01FA116
- sudo apt-get update -qq
- sudo apt-get install dpkg
- sudo apt-get install -y python-catkin-pkg python-rosdep python-wstool ros-$ROS_DISTRO-ros-base
- sudo sh -c 'echo "deb http://packages.ros.org/ros/ubuntu `lsb_release -sc` main"
  > /etc/apt/sources.list.d/ros-latest.list'
- wget http://packages.ros.org/ros.key -O - | sudo apt-key add -
- source /opt/ros/$ROS_DISTRO/setup.bash
- sudo rosdep init
- rosdep update
- sudo apt-get install ros-kinetic-rosbash
- sudo apt-get install ros-kinetic-roslaunch
- pip install --user catkin_lint
- pip install --user catkin_tools_document
- pip install --user codecov
- sudo apt-get install python-catkin-tools
install:
- mkdir -p ~/catkin_ws/src
- cd ~/catkin_ws
- catkin init
- catkin build
- source devel/setup.bash
- cd ~/catkin_ws/src
- ln -s $CI_SOURCE_PATH .
before_script:
- cd ~/catkin_ws/src
- wstool init
- if [[ -f $ROSINSTALL_FILE ]] ; then wstool merge $ROSINSTALL_FILE ; fi
- wstool up
- cd ~/catkin_ws
- rosdep update
- rosdep install -y --from-paths src --ignore-src --rosdistro $ROS_DISTRO
- cd src
- cd ~/catkin_ws
script:
- source /opt/ros/$ROS_DISTRO/setup.bash
- cd ~/catkin_ws
- src/march-iv/build.sh
- src/march-iv/doc.sh

# Code coverage
after_success:
  - catkin build march_gait_scheduler -v --no-deps --catkin-make-args march_gait_scheduler_coverage
  - catkin build march_safety -v --no-deps --catkin-make-args march_safety_coverage
  - cd ~/catkin_ws/src/march-iv
  - codecov -f ~/catkin_ws/build/march_gait_scheduler/march_gait_scheduler_coverage.info.removed
  - cd ~/catkin_ws/build/march_gait_selection
  - coverage xml
  - codecov -f ~/catkin_ws/build/march_gait_selection/coverage.xml
  - codecov -f ~/catkin_ws/build/march_safety/march_safety_coverage.info.removed
  - cd ~/catkin_ws


deploy:
  provider: pages
  skip_cleanup: true
  local_dir: "/home/travis/catkin_ws/docs/html"
  github_token: "$GH_REPO_TOKEN"
  on:
    branch: develop
